(function(){"use strict";var __webpack_modules__={709:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{G:function(){return DOMutils}});const DOMutils={create(t,e=null){const s=document.createElement(t);return e&&s.classList.add(e),s},addHTML(t,e){t.innerHTML=e},getText:t=>t.textContent.trim(),clear(t){this.addHTML(t,"")},getCoords:t=>t.getBoundingClientRect(),addClass(t,e){t.classList.add(e)},removeClass(t,e){t.classList.remove(e)},getCellId(t){const e=t.dataset.id.split(":");return{row:+e[0],col:+e[1]}},changeText(t,e){t.textContent=e},getStyles:(t=[],e)=>t.reduce(((t,s)=>(t[s]=e.style[s],t)),{}),attr(t,e,s){s&&t.setAttribute(e,s),t.getAttribute(e)},parseCell(value){return value.startsWith("=")?eval(value.slice(1)):value}}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var s=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](s,s.exports,__webpack_require__),s.exports}__webpack_require__.d=function(t,e){for(var s in e)__webpack_require__.o(e,s)&&!__webpack_require__.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var __webpack_exports__={};!function(){var t=__webpack_require__(709);class e{static get path(){return window.location.hash.slice(1)}static get param(){return e.path.split("/")[1]}static navigate(t){window.location.hash=t}}class s{constructor(t=""){this.params=t}getRoot(){throw new Error("Method should be implemented")}afterRender(){}destroy(){}}function n(t,e=null){if(!e)return JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify(e))}function r(t,e){let s;return function(...n){clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),t.apply(this,n)}),e)}}function i(t){t.preventDefault()}function a(t){const e=new Date(t),s=n(function(t){return`excel:${t}`}(t));return` <li class="dashboard__record">\n              <a href="#excel/${t}">${s.title}</a>\n              <strong>\n              ${e.toLocaleDateString()} \n              &ensp;\n              ${e.toLocaleTimeString()}\n              </strong>\n            </li>`}function o(t){return+t.split(":")[1]}function c(){const t=function(){const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s.includes("excel")&&t.push(s)}return t}();return t.length?`<div class="dashboard__list-header">\n            <span>Название</span>\n            <span>Дата открытия</span>\n          </div>\n          <ul class="dashboard__list">\n          ${t.map(o).sort(((t,e)=>e-t)).map(a).join("")}\n          </ul>`:"<p>Нет созданных таблиц</p>"}class l{constructor(t,e={}){this.initalState=e,this.rootReducer=t,this.listeners=new Set,this.state=this.rootReducer({...e},{type:"__INIT__"})}subscribe(t){this.listeners.add(t)}dispatch(t){this.state=this.rootReducer(this.state,t),this.listeners.forEach((t=>t(this.state)))}getState(){return JSON.parse(JSON.stringify(this.state))}unsubscribe(){this.listeners.clear()}}class u{constructor(){this.listeners={}}emit(t,...e){if(0==this.listeners[t].size)throw new Error("listeners is empty, please subscribe on event");this.listeners[t].forEach((t=>{t(...e)}))}subscribe(t,e){this.listeners[t]=this.listeners[t]||new Set,this.listeners[t].add(e)}unsubscribe(t,e){this.listeners[t].has(e)&&this.listeners[t].delete(e)}}class h{constructor(t){this.store=t,this.components=null,this.currState={}}setComponents(t){this.components=t}subComponents(){this.currState=this.store.getState(),this.store.subscribe((t=>{Object.keys(t).forEach((e=>{var s,n;s=this.currState[e],n=t[e],("object"==typeof s&&"object"==typeof n?JSON.stringify(s)===JSON.stringify(n):s===n)||this.components.forEach((s=>{if(s.isWatching(e)){const n={[e]:t[e]};s.storeChanged(n)}}))})),this.currState=this.store.getState()}))}unsubFromStore(){this.store.unsubscribe()}}class d{constructor(t){this.components=t.components||[],this.emitter=new u,this.store=t.store,this.subscriber=new h(this.store)}initComponent(e){const s={emitter:this.emitter,store:this.store},n=t.G.create("div",e.className),r=new e(n,s);return t.G.addHTML(n,r.toHTML()),r.prepare(),this.$excel.append(n),r}createExcel(){this.$excel=t.G.create("div",d.className),this.components=this.components.map((t=>this.initComponent(t))),this.subscriber.setComponents(this.components)}getRoot(){return this.createExcel(),this.$excel}init(){document.addEventListener("contextmenu",i),this.subscriber.subComponents(),this.components.forEach((t=>t.init()))}destroy(){this.subscriber.unsubFromStore(),this.components.forEach((t=>t.destroy())),document.removeEventListener("contextmenu",i)}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(d,"className","excel");function p(t){return`on${e=t,"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)}`;var e}class m extends class{constructor(t,e=[]){if(!t)throw new Error("no $root provided for DomListener");this.$root=t,this.listeners=e}initDOMListeners(){this.listeners.forEach((t=>{const e=p(t);if(!this[e])throw new Error(`The method ${e} is not create in ${this.name||""} component`);this[e]=this[e].bind(this),this.$root.addEventListener(t,this[e])}))}removeDOMListeners(){this.listeners.forEach((t=>{const e=p(t);this.$root.removeEventListener(t,this[e])}))}}{constructor(t,e={}){super(t,e.listeners),this.name=e.name,this.emitter=e.emitter,this.subs={},this.store=e.store,this.subscribe=e.subscribe||""}toHTML(){return""}prepare(){}init(){this.initDOMListeners()}destroy(){this.removeDOMListeners(),this.unsubscribeFromEvents()}emitEvent(t,...e){this.emitter.emit(t,...e)}storeChanged(){}subscribeOnEvent(t,e){this.subs[t]=e,this.emitter.subscribe(t,e)}unsubscribeFromEvents(){for(const[t,e]of Object.entries(this.subs))this.emitter.unsubscribe(t,e)}dispatch(t){this.store.dispatch(t)}isWatching(t){return this.subscribe.includes(t)}}const b={textAlign:"left",fontWeight:"normal",textDecoration:"none",fontStyle:"normal"},f="Новая таблица",v="TABLE_RESIZE",g="CHANGE_TEXT",_="APPLY_STYLE",y="CHANGE_STYLES",w="CHANGE_TITLE";class x extends m{constructor(t,e){super(t,{name:"Header",listeners:["input","click"],...e})}prepare(){this.onInput=r(this.onInput,100)}init(){super.init()}toHTML(){return`<input type="text" class="input" value="${this.store.getState().title||f}" />\n          <div class="buttons">\n            <div class="btn" data-btn="remove">\n              <span class="material-icons"> delete </span>\n            </div>\n            <div class="btn" data-btn="exit">\n              <span class="material-icons"> exit_to_app </span>\n            </div>\n          </div>`}onInput(t){const e=t.target;var s;this.dispatch((s=e.value,{type:w,data:s}))}onClick(t){const s=t.target;if(s.closest(".btn")){const t=s.closest(".btn");if("remove"===t.dataset.btn){confirm("Вы действительно хотите удалить таблицу?")&&(n="excel:"+e.param,localStorage.removeItem(n),e.navigate(""))}else"exit"===t.dataset.btn&&e.navigate("")}var n}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(x,"className","excel__header");class S extends m{constructor(...t){super(...t)}getTemplate(){return JSON.stringify(this.state,null,2)}initState(t={}){this.state={...t}}setState(t){this.state={...this.state,...t},this.$root.innerHTML=this.getTemplate()}}function E(t){const e=`data-type="button"\n                data-value='${JSON.stringify(t.value)}'`;return`<div class="btn ${t.active?"active":""}" ${e}>\n            <span class="material-icons" ${e}> ${t.icon} </span>\n          </div>`}class $ extends S{constructor(t,e){super(t,{name:"Toolbar",listeners:["click"],subscribe:["currentStyles"],...e}),this.initState(this.store.getState().currentStyles)}getTemplate(){return[{icon:"format_align_left",active:"left"===(t=this.state).textAlign,value:{textAlign:"left"}},{icon:"format_align_center",active:"center"===t.textAlign,value:{textAlign:"center"}},{icon:"format_align_right",active:"right"===t.textAlign,value:{textAlign:"right"}},{icon:"format_bold",active:"bold"===t.fontWeight,value:{fontWeight:"bold"===t.fontWeight?"normal":"bold"}},{icon:"format_italic",active:"italic"===t.fontStyle,value:{fontStyle:"italic"===t.fontStyle?"normal":"italic"}},{icon:"format_underlined",active:"underline"===t.textDecoration,value:{textDecoration:"underline"===t.textDecoration?"none":"underline"}}].map(E).join("");var t}toHTML(){return this.getTemplate()}storeChanged({currentStyles:t}){this.setState(t)}onClick(t){const e=t.target;if("button"===e.dataset.type){const t=JSON.parse(e.dataset.value);this.emitEvent("toolbar:applyStyle",t)}}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}($,"className","excel__toolbar");class T extends m{constructor(t,e){super(t,{name:"Formula",listeners:["input","keydown"],subscribe:["currentText"],...e})}prepare(){this.$input=this.$root.querySelector(".input"),this.subscribeEvents()}storeChanged({currentText:e}){t.G.changeText(this.$input,e)}subscribeEvents(){this.subscribeOnEvent("table:select",(e=>{t.G.changeText(this.$input,e)}))}toHTML(){return'\n          <div class="info">fx</div>\n          <div class="input" contenteditable="true" spellcheck="false"></div>'}onInput(){const e=t.G.getText(this.$input);this.emitEvent("formula:input",e)}onKeydown(t){["Enter","Tab"].includes(t.key)&&(t.preventDefault(),this.emitEvent("formula:done"))}}function C(t,e){return t>e&&([e,t]=[t,e]),new Array(e-t+1).fill("").map(((e,s)=>t+s))}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(T,"className","excel__formula");const L=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);function k(e,s){return new Promise((n=>{"col"===s.dataset.resize?n(function(e,s){return new Promise((n=>{let r;const i=e.closest('[data-type="resizeble"]'),a=t.G.getCoords(i),o=i.dataset.col,c=s.querySelectorAll(`[data-col='${o}']`);e.style.height=L+"px",e.style.zIndex=1e3;const l=t=>{const s=t.clientX-a.left-i.clientWidth;r=a.width+s,e.style.left=r-e.clientWidth+"px"};document.addEventListener("mousemove",l),document.onmouseup=()=>{r<40&&(r=40),n({value:r,id:o,type:"col"}),e.style.left=r-e.offsetWidth+"px",e.style.zIndex=100,e.style.height=i.offsetHeight+"px",c.forEach((t=>t.style.width=r+"px")),document.removeEventListener("mousemove",l),document.onmouseup=null}}))}(s,e)):n(function(e){return new Promise((s=>{let n;const r=e.closest('[data-type="resizeble"]'),i=t.G.getCoords(r),a=r.dataset.id;e.style.width=r.offsetWidth+"px",e.style.zIndex=1e3;const o=t=>{const s=t.clientY-i.top-r.clientHeight;n=i.height+s,e.style.top=n-e.clientHeight+"px"};document.addEventListener("mousemove",o),document.onmouseup=()=>{n<24&&(n=24),s({value:n,id:a,type:"row"}),e.style.top=n-e.offsetHeight+"px",e.style.zIndex=100,e.style.width="40px",r.style.height=n+"px",document.removeEventListener("mousemove",o),document.onmouseup=null}}))}(s))}))}const O=65,H=90;function G(t={},e){return t[e]?t[e]+"px":"120px"}function A(t,e){return String.fromCharCode(O+e)}function M(e,s){return function(n,r){const i=`${e}:${r}`,a=G(s.colState,r),o=t.G.parseCell(function(t,e){return t[e]||""}(s.dataState,i));return`<div class="cell" \n            contenteditable="" \n            data-col='${r}' \n            data-id='${i}'\n            data-value="${o}"\n            style="${function(t={}){return Object.keys(t).map((e=>{return`${s=e,s.replace(/([A-Z])/g,(t=>`-${t[0].toLowerCase()}`))}: ${t[e]}`;var s})).join(";")}({...b,...s.stylesState[i]})};width:${a}">${o}</div>`}}function j({col:t,index:e,width:s}){return`<div class="column" data-type="resizeble" style="width:${s}" \n   data-col='${e}'>${t} \n          <div class="col-resize" data-resize="col"></div>\n  </div>`}function D(t,e,s={}){const n=function(t={},e){return t[e]?t[e]+"px":"24px"}(s.rowState,t);return`<div class="row"\n          style="height:${n} \n          "data-id="${t}"  data-type="${t?"resizeble":""}">\n          <div class="row-info">${t||""}\n          ${t?'<div class="row-resize" data-resize="row"></div>':""}\n          </div>\n          <div class="row-data">${e}</div>\n          </div>`}function I(t=15,e){const s=H-O+1,n=[],r=new Array(s).fill("").map(A).map(function(t){return function(e,s){return{col:e,index:s,width:G(t.colState,s)}}}(e)).map(j).join("");n.push(D(null,r));for(let r=0;r<t;r++){const t=new Array(s).fill("").map(M(r,e)).join("");n.push(D(r+1,t,e))}return n.join("")}function N(t,e,s){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,s)}function z(t,e){var s=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}(t,e,"get");return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,s)}var P=new WeakMap;class R{constructor(t){N(this,P,{writable:!0,value:"selected"}),this.group=[],this.$table=t,this.current}select(e=this.current){this.clearSelect(),this.group.push(e),this.current=e,this.current.focus(),t.G.addClass(e,z(this,P))}selectGroup(e){this.clearSelect(),this.group=this.getCells(e),this.group.forEach((e=>t.G.addClass(e,z(this,P))))}get selectedIds(){return this.group.map((t=>t.dataset.id))}clearSelect(){this.group.forEach((e=>t.G.removeClass(e,z(this,P)))),this.group=[]}getCells(e){const s=t.G.getCellId(this.current),n=t.G.getCellId(e),r=C(s.col,n.col);return C(s.row,n.row).reduce(((t,e)=>(r.forEach((s=>t.push(`${e}:${s}`))),t)),[]).map((t=>this.$table.querySelector(`[data-id="${t}"]`)))}applyStyle(t){const[e,s]=Object.entries(t)[0];this.group.forEach((t=>{t.style[e]=`${s}`}))}}function q(t,e,s){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,s)}function W(t,e){var s=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}(t,e,"get");return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,s)}var J=new WeakMap;class F extends m{constructor(t,e){super(t,{name:"Table",listeners:["mousedown","keydown","input"],...e}),q(this,J,{writable:!0,value:34})}toHTML(){return I(W(this,J),this.store.getState())}prepare(){this.selection=new R(this.$root),this.subscribeEvents()}init(){super.init();const t=this.$root.querySelector("[data-id='0:0']");this.selection.select(t),this.updateCurrentStyle(t),this.giveCellText(t,"table:select")}subscribeEvents(){this.subscribeOnEvent("formula:input",(e=>{t.G.attr(this.selection.current,"data-value",e);const s=t.G.parseCell(e);t.G.changeText(this.selection.current,s),this.updateStoreText(e)})),this.subscribeOnEvent("formula:done",(()=>this.selection.select())),this.subscribeOnEvent("toolbar:applyStyle",(t=>{var e;this.selection.applyStyle(t),this.dispatch((e={value:t,ids:this.selection.selectedIds},{type:_,data:e}))}))}updateCurrentStyle(e){const s=t.G.getStyles(Object.keys(b),e);this.dispatch({type:y,data:s})}giveCellText(t,e){const s=t.dataset.value;this.emitEvent(e,s)}async resizeTable(t){try{const e=await k(this.$root,t);this.dispatch(function(t){return{type:v,data:t}}(e))}catch(t){console.log(t)}}onMousedown(t){const e=t.target;e.dataset.resize?(t.preventDefault(),this.resizeTable(e)):function(t){return t.dataset.id}(e)&&(t.shiftKey?this.selection.selectGroup(e):(this.selection.select(e),this.giveCellText(this.selection.current,"table:select"),this.updateCurrentStyle(e)))}onKeydown(e){const{key:s}=e;if(["Enter","Tab","ArrowLeft","ArrowRight","ArrowDown","ArrowUp"].includes(s)&&!e.shiftKey){e.preventDefault();const n=t.G.getCellId(this.selection.current),r=this.$root.querySelector(function(t,{row:e,col:s},n){switch(t){case"Enter":case"ArrowDown":++e>n&&(e=n);break;case"Tab":case"ArrowRight":++s>25&&(s=25);break;case"ArrowLeft":--s<0&&(s=0);break;case"ArrowUp":--e<0&&(e=0)}return`[data-id="${e}:${s}"]`}(s,n,W(this,J)-1));this.selection.select(r),this.giveCellText(r,"table:select")}}updateStoreText(t){var e;this.dispatch((e={id:this.selection.current.dataset.id,value:t},{type:g,data:e}))}onInput(e){const s=e.target;this.updateStoreText(t.G.getText(s))}}function K(t,e){let s;switch(e.type){case v:return s="col"===e.data.type?"colState":"rowState",{...t,[s]:Y(t,s,e)};case g:return s="dataState",{...t,currentText:e.data.value,[s]:Y(t,s,e)};case y:return{...t,currentStyles:e.data};case _:s="stylesState";const n=t[s]||{};return e.data.ids.forEach((t=>{n[t]={...n[t],...e.data.value}})),{...t,[s]:n,currentStyles:{...t.currentStyles,...e.data.value}};case w:return{...t,title:e.data};default:return t}}function Y(t,e,s){const n=t[e]||{};return n[s.data.id]=s.data.value,n}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(F,"className","excel__table");const U={rowState:{},colState:{},dataState:{},currentText:"",currentStyles:b,stylesState:{},title:f};function B(t){return t?(t=>({...t,currentStyles:b,currentText:""}))(t):(e=U,JSON.parse(JSON.stringify(e)));var e}new class{constructor(t,e){if(!t)throw new Error("Selector is not provided in Router");this.$placeholder=document.querySelector(t)||document.createElement("div",t),this.routes=e,this.changePageHandler=this.changePageHandler.bind(this),this.page=null,this.init()}init(){window.addEventListener("hashchange",this.changePageHandler),this.changePageHandler()}changePageHandler(){this.page&&this.page.destroy(),t.G.clear(this.$placeholder);const s=e.path.includes("excel")?this.routes.excel:this.routes.dashboard;this.page=new s(e.param);const n=this.page.getRoot();this.$placeholder.append(n),this.page.afterRender()}destroy(){window.removeEventListener("hashchange",this.changePageHandler)}}("#app",{dashboard:class extends s{getRoot(){console.log(this.params);const e=Date.now().toString(),s=t.G.create("div","dashboard");return t.G.addHTML(s,`\n        <div class="dashboard__header">\n          <h1>Excel Dashboard</h1>\n        </div>\n        <div class="dashboard__new">\n          <div class="dashboard__view">\n            <a href="#excel/${e}" class="dashboard__create">\n              Новая<br />\n              Таблица\n            </a>\n          </div>\n        </div>\n        <div class="dashboard__table dashboard__view">\n          ${c()}\n        </div>`),s}},excel:class extends s{getRoot(){this.params||(this.params=Date.now().toString(),e.navigate(`#excel/${this.params}`));const t="excel:"+this.params;const s=function(t,e){return new l(t,e)}(K,B(n(t))),i=r((e=>{n(t,e)}),200);return s.subscribe(i),this.excel=new d({components:[x,$,T,F],store:s}),this.excel.getRoot()}afterRender(){this.excel.init()}destroy(){this.excel.destroy()}}})}()})();